<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
    <meta content="initial-scale=1,user-scalable=no,width=640" name="viewport">
    <title>fiddle</title>
  </head>
  <body>

    <script src="bower_components/requirejs/require.js"></script>

    <script>

      require.config({
        baseUrl: 'scripts',
        enforceDefine: true,
        paths: {
          foo: 'cdn/foo'
        }
      })

      //
      // errback
      // define() 仅用于定义模块，不支持 errback
      //

      require(
        ['foo'],  // 尝试从 CDN 获取脚本
        function callback(foo) {
          foo.hi()
        },
        function errback(error) {

          var moduleID = error.requireModules && error.requireModules[0]

          if ('foo' === moduleID) {

            // 移除无效的模块定义
            require.undef(moduleID)

            // 重新配置加载路径
            require.config({
              paths: {
                foo: 'local/foo'
              }
            })

            // 重新获取脚本（会触发之前注册的回调）
            require(['foo'])

          }

        }
      )


      //
      // 上面的一系列操作可以使用 path fallback 来简化
      //

      require.config({
        paths: {
          bar: [ 'cdn/bar', 'local/bar' ]
        }
      })

      require(['bar'], function callback(bar) {
        bar.hi()
      })

    </script>

  </body>
</html>
